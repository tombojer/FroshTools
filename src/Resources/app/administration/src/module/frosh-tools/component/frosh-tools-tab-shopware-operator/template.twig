<div class="frosh-tools-tab-shopware-operator">
    <sw-card
        deprecated
        :title="$t('frosh-tools.tabs.shopwareOperator.title')"
        :large="true"
        positionIdentifier="frosh-tools-shopware-operator"
    >
        <sw-card-section>
            <sw-loader v-if="isLoading"></sw-loader>
            <sw-container v-else-if="error" columns="1fr" justify="center">
                <sw-alert variant="error">{{ error }}</sw-alert>
            </sw-container>
            <div v-else-if="data && data.stores.length === 0">
                <sw-alert variant="info">{{ $t('frosh-tools.tabs.shopwareOperator.noStores') }}</sw-alert>
            </div>
            <div v-else>
                <sw-card-section
                    v-for="store in data.stores"
                    :key="store.name"
                    divider="bottom"
                >
                    <!-- Store Header -->
                    <div class="store-header">
                        <h3>{{ store.name }}</h3>
                        <span :class="getStoreStateClass(store.state)">{{ store.state }}</span>
                    </div>
                    <div class="store-namespace">{{ store.namespace }}</div>

                    <!-- Deployments -->
                    <h4>{{ $t('frosh-tools.tabs.shopwareOperator.deployments.title') }}</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>{{ $t('frosh-tools.tabs.shopwareOperator.deployments.type') }}</th>
                                <th>{{ $t('frosh-tools.tabs.shopwareOperator.deployments.state') }}</th>
                                <th>{{ $t('frosh-tools.tabs.shopwareOperator.deployments.replicas') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(deployment, type) in store.deployments" :key="type">
                                <td class="deployment-type">{{ type }}</td>
                                <td>
                                    <span :class="getDeploymentStateClass(deployment.state)">{{ deployment.state }}</span>
                                </td>
                                <td>{{ deployment.availableReplicas }} / {{ deployment.desiredReplicas }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- HPA & Scheduled Task -->
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-card__label">{{ $t('frosh-tools.tabs.shopwareOperator.hpa.enabled') }}</div>
                            <span :class="store.hpa.enabled ? 'status-badge status-badge--success' : 'status-badge status-badge--warning'">
                                {{ store.hpa.enabled ? $t('frosh-tools.tabs.shopwareOperator.hpa.yes') : $t('frosh-tools.tabs.shopwareOperator.hpa.no') }}
                            </span>
                            <div class="metric-card__subtext" v-if="store.hpa.enabled">
                                {{ store.hpa.minReplicas }} â€“ {{ store.hpa.maxReplicas }} {{ $t('frosh-tools.tabs.shopwareOperator.hpa.replicas') }}
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-card__label">{{ $t('frosh-tools.tabs.shopwareOperator.scheduledTask.lastRunStatus') }}</div>
                            <span :class="getScheduledTaskStatusClass(store.scheduledTask.lastRunStatus)">
                                {{ getScheduledTaskStatusLabel(store.scheduledTask.lastRunStatus) }}
                            </span>
                        </div>
                        <div class="metric-card">
                            <div class="metric-card__label">{{ $t('frosh-tools.tabs.shopwareOperator.scheduledTask.suspended') }}</div>
                            <span :class="store.scheduledTask.suspended ? 'status-badge status-badge--warning' : 'status-badge status-badge--success'">
                                {{ store.scheduledTask.suspended ? $t('frosh-tools.tabs.shopwareOperator.scheduledTask.yes') : $t('frosh-tools.tabs.shopwareOperator.scheduledTask.no') }}
                            </span>
                        </div>
                        <div class="metric-card" v-if="store.scheduledTask.lastSuccessTimestamp">
                            <div class="metric-card__label">{{ $t('frosh-tools.tabs.shopwareOperator.scheduledTask.lastSuccess') }}</div>
                            <div class="metric-card__value metric-card__value--sm">{{ formatTimestamp(store.scheduledTask.lastSuccessTimestamp) }}</div>
                        </div>
                    </div>

                    <!-- Current Image -->
                    <div class="image-info" v-if="store.currentImage">
                        <div class="metric-card__label">{{ $t('frosh-tools.tabs.shopwareOperator.currentImage') }}</div>
                        <code class="image-tag">{{ store.currentImage }}</code>
                    </div>
                </sw-card-section>
            </div>
        </sw-card-section>
    </sw-card>
</div>
